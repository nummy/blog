广播指将一组规则应用于对不同大小的数组调用通用函数的过程中。

## 广播简介

对于相同大小的数组，二元操作是基于数组元素一一对应进行操作的。

```python
import numpy as np
a = np.array([0, 1, 2])
b = np.array([5, 5, 5])
a + b
```

结果为：

```python
array([5, 6, 7])
```

广播允许这些二元操作作用在不同大小的数组上。例如，我们可以将一个标量和一个数组相加：

```python
a + 5
# array([5, 6, 7])
```

我们可以将5看成数组`[5,5,5]`与`a`相加。广播实际上并没有做这一步操作，但是我们这样想的话比较容易理解。

同样我们可以将这扩展到高纬度的数组，查看下面操作的结果：

```python
M = np.ones((3, 3))
M
```

结果为：

```
array([[ 1.,  1.,  1.],
       [ 1.,  1.,  1.],
       [ 1.,  1.,  1.]])
```

```
M + a
```

结果为：

```
array([[ 1.,  2.,  3.],
       [ 1.,  2.,  3.],
       [ 1.,  2.,  3.]])
```

这里数组`a`进行了扩展，或者说沿第二维度进行了广播，以匹配M的形状。

上面的例子比较好理解，接下来讲一个复杂的例子：

```python
a = np.arange(3)
b = np.arange(3)[:, np.newaxis]

print(a)
print(b)
```

输出为：

```
[0 1 2]
[[0]
 [1]
 [2]]
```

执行加法操作：

```
a + b
```

结果为：

```
array([[0, 1, 2],
       [1, 2, 3],
       [2, 3, 4]])
```

这里我们同时对a和b进行了广播，以匹配共同的形状，所以结果是一个二维数组。

![](./img/02.05-broadcasting.png)

上面颜色比较淡的方块代表了广播值，实际上并没有分配格外的内存，但是有利于理解。

## 广播的规则

广播严格遵守以下规则：

- 如果两个数组有只是维度的数目不一致，维度少的数组需要补齐缺少的维度。
- 如果两个数组的形状在任何维度上都不一致，