前面我们学习了`Numpy`数组的简单索引，切片和布尔值掩码索引。这一节，我们将学习另外一种索引，花式索引(Fancy Index)。花式索引跟简单索引类似，不一样的地方是，花式索引传递索引数组而不是一个标量值，这样我们就可以很快的操作数据集的部分数据。

### 探索花式索引

花式索引的概念非常简单，它传递一个索引数组以获取多个数组元素，假设存在如下数组：

```python
import numpy as np
rand = np.random.RandomState(42)

x = rand.randint(100, size=10)
print(x)
```

假设需要访问多个不同的元素，可以这样写：

```python
[x[3], x[7], x[2]]   # [71, 86, 14]
```

同样可以这样写：

```python
ind = [3, 7, 4]
x[ind]
# array([71, 86, 60])
```

当使用花式索引的时候，结果数组的形式由索引决定，而不是原始数组。

```python
ind = np.array([[3, 7],
                [4, 5]])
x[ind]
# array([[71, 86],[60, 20]])
```

花式索引也可以作用在多维数组上面：

```python
X = np.arange(12).reshape((3, 4))
X
```

结果为：

```python
array([[ 0,  1,  2,  3],
       [ 4,  5,  6,  7],
       [ 8,  9, 10, 11]])
```

跟标准索引类似，索引的第一个元素指向行，第二个元素指向列：

```python
row = np.array([0, 1, 2])
col = np.array([2, 1, 3])
X[row, col]
# array([ 2,  5, 11])
```

第一个值为`X[0,2]`，第二个值为`X[1,1]`，第三个值为`x[2,3]`。花式索引同样遵守广播的规则。例如，下面的结果为一个二维数组：

```python
X[row[:, np.newaxis], col]
```

结果为：

```
array([[ 2,  1,  3],
       [ 6,  5,  7],
       [10,  9, 11]])
```

所以要特别注意，花式索引返回的结果的形状是索引广播之后的形状。

### 组合索引

花式索引还可以与其他索引组成更为复杂的操作：

```python
X[2, [2, 0, 1]]
```

结果为：

```
array([10,  8,  9])
```

花式索引于切片一起使用：

```python
X[1:, [2, 0, 1]]
```

结果为：

```
array([[ 6,  4,  5],
       [10,  8,  9]])
```

花式索引与掩码组合使用：

```python
mask = np.array([1, 0, 1, 0], dtype=bool)
X[row[:, np.newaxis], mask]
```

结果为：

```
array([[ 0,  2],
       [ 4,  6],
       [ 8, 10]])
```

### 使用花式索引修改值

花式索引也可以用来修改数组的值，例如：

```python
x = np.arange(10)
i = np.array([2, 1, 8, 4])
x[i] = 99
print(x)
```

结果为：

```python
[ 0 99 99  3 99  5  6  7 99  9]
```

可以使用任何赋值操作符进行修改：

```python
x[i] -= 10
print(x)
# [ 0 89 89  3 89  5  6  7 89  9]
```

注意，重复的索引值容易导致问题：

```python
x = np.zeros(10)
x[[0, 0]] = [4, 6]
print(x)
# [ 6.  0.  0.  0.  0.  0.  0.  0.  0.  0.]
```

4去哪儿了呢？这个操作的过程其实是这样的，首先`x[0]=4`，然后`x[0]=6`，所以就出现上面的结果。但是看下面的操作：

```python
i = [2, 3, 3, 4, 4, 4]
x[i] += 1
x
```

结果为`array([ 6.,  0.,  1.,  1.,  1.,  0.,  0.,  0.,  0.,  0.])`。

