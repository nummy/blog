Tornado提供了一个简单，快速，灵活的模板引擎。

Tornado也可以使用其他任意的模板引擎， 尽管并没有明确规则如何在`RequestHandler.render`整合进这些引擎。实际上只需要将模板渲染成字符串，然后传递给`RequestHadler.write`方法即可。

### 配置模板

默认情况下，Tornado会在跟Python文件相同的目录下查找模板文件。如果需要将模板文件放在单独的路径，可以通过`Application setting`中的`template_path` 进行配置，如果是要求不同处理器的模板不一样，则可以重写`RequestHandler.get_tempplate_path`方法。

如果需要从非文件系统中加载模板，则可以继承`tornado.template.BaseLoader`然后传递它的一个实例给`application`配置的`template_loader`参数。

默认会缓存编译之后的模板，如果需要取消缓存，则需要设置参数`compiled_template_cached=False`和`debug=True`。

### 模板语法

Tornado模板语言实际上就是嵌套了Python流程控制语句和表达式的HTML文本。

```html
<html>
   <head>
      <title>{{ title }}</title>
   </head>
   <body>
     <ul>
       {% for item in items %}
         <li>{{ escape(item) }}</li>
       {% end %}
     </ul>
   </body>
 </html>
```

如果将上面的模板存储为`template.html`，并与`py`文件存放在同一目录，渲染过程如下:

```python
class MainHandler(tornado.web.RequestHandler):
    def get(self):
        items = ["Item 1", "Item 2", "Item 3"]
        self.render("template.html", title="My title", items=items)
```

Tornado模板支持流程控制语句和表达式，流程控制语句被`{%`和`%}`括起来，例如:`{% if len(items) > 2 %}`。表达式被`{{`和`}}`括起来，例如：`{{ items[0] }}`。

流程控制语法与Python类似，Tornado现在支持`if`， `for`, `while`和`try`，这些语句都以`{% end %}`结尾。Tornado同样支持模板继承`extends`和块`block`语句。具体参考`tornado.template`。

模板中的表达式可以为任意的Python表达式，包括函数调用。模板中的代码在一个命名空间中执行，这个命名空间包括了如下对象和函数。

- `escape`:  [`tornado.escape.xhtml_escape`](http://www.tornadoweb.org/en/stable/escape.html#tornado.escape.xhtml_escape)的别名
- `xhtml_escape`:  [`tornado.escape.xhtml_escape`](http://www.tornadoweb.org/en/stable/escape.html#tornado.escape.xhtml_escape)的 别名
- `url_escape`: [`tornado.escape.url_escape`](http://www.tornadoweb.org/en/stable/escape.html#tornado.escape.url_escape)的别名
- `json_encode`: [`tornado.escape.json_encode`](http://www.tornadoweb.org/en/stable/escape.html#tornado.escape.json_encode)的别名
- `squeeze`:  [`tornado.escape.squeeze`](http://www.tornadoweb.org/en/stable/escape.html#tornado.escape.squeeze) 的别名
- `linkify`:  [`tornado.escape.linkify`](http://www.tornadoweb.org/en/stable/escape.html#tornado.escape.linkify) 的别名
- `datetime`: Python [`datetime`](https://docs.python.org/3.5/library/datetime.html#module-datetime) 模块
- `handler`: 当前 [`RequestHandler`](http://www.tornadoweb.org/en/stable/web.html#tornado.web.RequestHandler) 对象
- `request`:  [`handler.request`](http://www.tornadoweb.org/en/stable/httputil.html#tornado.httputil.HTTPServerRequest)的别名
- `current_user`:  [`handler.current_user`](http://www.tornadoweb.org/en/stable/web.html#tornado.web.RequestHandler.current_user)的别名
- `locale`:  [`handler.locale`](http://www.tornadoweb.org/en/stable/locale.html#tornado.locale.Locale)的别名
- `_`:  [`handler.locale.translate`](http://www.tornadoweb.org/en/stable/locale.html#tornado.locale.Locale.translate)的别名
- `static_url`:  [`handler.static_url`](http://www.tornadoweb.org/en/stable/web.html#tornado.web.RequestHandler.static_url)的别名
- `xsrf_form_html`: [`handler.xsrf_form_html`](http://www.tornadoweb.org/en/stable/web.html#tornado.web.RequestHandler.xsrf_form_html)的别名
- `reverse_url`:  [`Application.reverse_url`](http://www.tornadoweb.org/en/stable/web.html#tornado.web.Application.reverse_url)的别名
- `ui_methods` 和 `ui_modules` `Application` 配置的所有入口
- 传递给 [`render`](http://www.tornadoweb.org/en/stable/web.html#tornado.web.RequestHandler.render) 或者 [`render_string`](http://www.tornadoweb.org/en/stable/web.html#tornado.web.RequestHandler.render_string)的任意参数

当我们创建系统应用时，需要利用到Tornado的很多特性，具体可以参考`tornado.template`的文档。

Tornado模板会被编译为Python代码，所有的模板输出默认都会使用`tornado.escape.xhtml_escape`转义，可以在应用的设置中通过参数`autoescape=False`来关闭转义，或者在`tornado.template.Loader`构造器中设置这个参数。如果是在模板文件中，可以使用`{% autoescape None %}` 指令。如果是表达式，则可以使用`{% raw ...%}`。

Tornado提供的自动转义可以避免`XSS`攻击，但是它并不能处理所有情况，例如Javascript和CSS中的表达式可能需要格外的转义。

### 国际化

